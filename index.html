<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>taskCat</title>

    <style>
        *{
            box-sizing: content-box;
            font-family: monospace;
        }
        html,body{
            height: 100%;
            width: 100%;
            margin: 0;
        }

        body{
            height: 100dvh;
            padding: 0;
            margin: 0;
        }
        .main-screen{
            background-color: whitesmoke;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #loading{
            height: 100%;
            width: 100%;
            background-color: black;
            color: white;
            display: none;
            justify-content: center;
            align-items: center;
        }
        #main-stage{
            height: 100%;
            width: 100%;
            background-color: rgba(0, 128, 0, 0.481);
            position: relative;
            justify-content: center;
            align-items: center;
        }
        #firstTimeScreen, #oldUserScreen{
            height: 100%;
            width: 100%;
            top: 0;
            left: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            
        }

        /*FIRST TIME SCREEN */
        #box{
            height: 25%;
            aspect-ratio: 1/1;
            background-color: purple;
            position: absolute;
        }
        #cat{
            height: 30%;
            aspect-ratio: 1/1;
            background-color: yellow;
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            
       }
       #youReceivedText{
        position: absolute;
        top: 65%;
        text-align: center;
        opacity: 0;

       }

       #renamePopUpScreen{
        height: 100%;
        width: 100%;
        position: absolute;
        top:0;
        justify-content: center;
        display: flex;
        align-items: center;
       }
       #renamePopUp{
        width: 70%;
        height: 50%;
        background-color: blue;
        display:flex;
        flex-direction: column;

       }
       .rename-title{
        height:10%;
        width: 100%;
        background-color: green;
        display: flex;
        justify-content: center;
        align-items: center;
       }
       .rename-photo-name-wrapper{
        height: 50%;
        width: 100%;
        background-color: whitesmoke;
        display: flex;
           }

        .rename-photo{
            height: 100%;
            width: 40%;
            background-color: yellow;
        }
        .rename-name{
            height:100%;
            width: 60%;
            background-color: orange;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        .rename-name h1{
            margin: 0;
            padding: 0;
        }
        #renameInput{
            position: absolute;
            height: 50%;
            width : 100%;
            opacity: 0;
        }
        .rename-button-wrapper{
            height: 40%;
            width: 100%;
            background-color: pink;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        #renameConfirmBtn{
            padding: 20px;

        }
        #statusBox{
            height: 30%;
            width: 40%;
            background-color: red;
            position: absolute;
            top:0;
            left: 0;
display: flex;
            flex-direction: column;

        }
        #statusBoxName, #statusBoxHunger, #statusBoxHappiness{
            height: 33.3%;
            width: 100%;
            background-color:white;
            display: flex;
            flex-direction: column;
        }
        #statusBoxNameH1{
            margin: 0;
            
        } 
        #hungerBar, #happinessBar{
            height:50%;
            width:95%;
            border: 2px black solid;
            overflow: hidden;
            margin-left: 1.5%;
            display: flex;
            position: relative;


        }
        #hungerBarContent{
            height: 100%;
            width: 100%;
            background-color: green;
        }

        #happinessBarContent{
            height: 100%;
            width: 100%;
            background-color: red;
        }

        #hungerBarPoints{
            position: absolute;
            top:0%;
            left: 0%;
            margin:0;
            padding: 0;
            
        }
        #bottomAccessBar{
            width: 100%;
            height: 10dvh;
            background-color: yellow;
            position: absolute;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
           
        }

        #items, #store, #tasks{
            flex: 1;
            margin: 10px;
            height: 70%;
        }

        #itemsPopUpWrapper, #storePopUpWrapper, #tasksPopUpWrapper{
            height: 100%;
            width: 100%;
            background-color: rgba(0, 0, 255, 0.213);
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
        }

            </style>
</head>
<body>
    <main class="main-screen">
        <div id="loading">
            <h1>Loading</h1>
        </div>
        <div id="main-stage">
            <div id="firstTimeScreen">
                <h1>First Time</h1>
                <div id="box"></div>
                <div id="cat">
                   <h1 id="catTypeText">Cat</h1>
                </div>
                <h1 id="youReceivedText">You received</h1>
            </div>
            <div id="renamePopUpScreen">
                <div id="renamePopUp">
                    <div class="rename-title">Rename?</div>
                    <div class="rename-photo-name-wrapper">
                        <div class="rename-photo"></div>
                        <div class="rename-name">
                            <h1 id="renameName">Name</h1>
                            <input id="renameInput" type="text" />
                        </div>
                    </div>
                    <div class="rename-button-wrapper">
                        <button id="renameConfirmBtn">Confirm</div>
                    </div>
                </div>
            </div>
            <div id="oldUserScreen">
                <h1>Old user</h1>

            </div>
            <div id=statusBox>
                <div id="statusBoxName"> Name
                    <h1 id="statusBoxNameH1"> Name </h1>
                </div>
                <div id="statusBoxHunger" > Hunger
                    <div id="hungerBar">
                        <h1 id="hungerBarPoints">n /100</h1>
                        <div id="hungerBarContent"></div>
                    </div>
                </div>
                <div id="statusBoxHappiness" > Happiness
                    <div id="happinessBar">
                        <div id="happinessBarContent">
                        </div>
                    </div>
                         </div>
            </div>
            <div id="bottomAccessBar">
                <button id="items"> Items </button>
                <button id="store"> Store </button>
                <button id="tasks"> Task </button>
            </div>

            <div id="itemsPopUpWrapper">
                <h1>ITEMS</h1>
            </div>
            <div id="storePopUpWrapper"><h1>STORE</h1></div>
            <div id="tasksPopUpWrapper"><h1>TASKS</h1></div>
        </div>

    </main>
    <script>

        const loadingScreen = document.getElementById("loading");
        const MainScreen = document.getElementById("main-stage");
        const renamePopUpScreen = document.getElementById("renamePopUpScreen");
        const statusBox = document.getElementById("statusBox");
        const oldUserScreen = document.getElementById("oldUserScreen");
        const firstTimeScreen = document.getElementById("firstTimeScreen");
        const youReceivedText = document.getElementById("youReceivedText");
        const catTypeText = document.getElementById('catTypeText');
        const box = document.getElementById('box');
        const cat = document.getElementById('cat');
        const renameName = document.getElementById('renameName');
        let catName;
        const renameInput = document.getElementById("renameInput");
        const renameConfirmBtn = document.getElementById('renameConfirmBtn');
        const statusBoxNameH1 = document.getElementById('statusBoxNameH1');      
        const hungerBarContent = document.getElementById('hungerBarContent');
        const happinessBarContent = document.getElementById('happinessBarContent'); 
        const hungerBarPoints = document.getElementById("hungerBarPoints");

        const itemsBtn = document.getElementById('items');
        const storeBtn = document.getElementById('store');
        const tasksBtn = document.getElementById('tasks');

        const itemsPopUpWrapper = document.getElementById('itemsPopUpWrapper');
        const storePopUpWrapper = document.getElementById('storePopUpWrapper');
        const tasksPopUpWrapper = document.getElementById('tasksPopUpWrapper');

        const STATES = {
            LOADING : 'loadingScreen',
            MAIN : 'MainScreen'
        }

        const checkIfFirstTime =()=>{
            if (localStorage.getItem("firstTimeUsing") === null){
                localStorage.setItem("firstTimeUsing", "true")
            }
            const isFirstTime = localStorage.getItem("firstTimeUsing") === "true";

            if (isFirstTime){
                firstTimeScreen.style.display = "flex";
                oldUserScreen.style.display = "none";
            }
            else{
                oldUserScreen.style.display = "flex";
                firstTimeScreen.style.display = "none";
            }
        }

        const clearWrappers =()=>{
            ([itemsPopUpWrapper, storePopUpWrapper, tasksPopUpWrapper]).forEach(wrapper => wrapper.style.display = "none");
        }
    
        const randomizeCatType =()=>{
            const catTypes = ["wawu", "mimi", "mekus","kuchi","nano"];
            const catRandomizer = catTypes[Math.floor(Math.random() * (catTypes.length))];

            youReceivedText.innerHTML = `You Received, <br/> ${catRandomizer}!`;
            catTypeText.innerHTML = catRandomizer;
            renameName.innerHTML = catRandomizer;
            catName = catRandomizer;
        }

        const displayRenamePopUp =()=>{
            renamePopUpScreen.style.display = "flex";
            youReceivedText.style.display = "none";
        }

        const displayStatusBox =()=>{
            statusBox.style.display = "flex";
            const catSavedName = JSON.parse(localStorage.getItem("catSavedName"));
            computeHunger();
            setInterval(computeHunger, 1000);
            statusBoxNameH1.innerHTML = catSavedName;
        }

const computeHunger = () => {
    if (localStorage.getItem('lastHungerAmount') === null) {
        localStorage.setItem('lastHungerAmount', 100);
    }
    if (!localStorage.getItem('lastHungerTimeCheck') === null) {
        localStorage.setItem('lastHungerTimeCheck', Date.now());
    }

    let hungerAmount = Number(localStorage.getItem('lastHungerAmount'));
    let lastHungerTimeCheck = Number(localStorage.getItem('lastHungerTimeCheck'));

    let elapsedTime = Date.now() - lastHungerTimeCheck;
    let hungerLoss = Math.floor(elapsedTime / 300000);

    hungerBarPoints.innerHTML = `${hungerAmount}/100`;

    if (hungerLoss > 0) {
        hungerAmount = Math.max(0, hungerAmount - hungerLoss);

        lastHungerTimeCheck += hungerLoss * 300000;

        localStorage.setItem('lastHungerAmount', hungerAmount);
        localStorage.setItem('lastHungerTimeCheck', lastHungerTimeCheck);
    }

    hungerBarContent.style.width = `${hungerAmount}%`;
};


        window.addEventListener('load', ()=>{
            checkIfFirstTime();
            //remove later: // 
            cat.style.display = "none";
            renamePopUpScreen.style.display = "none";
            statusBox.style.display = "none";
            clearWrappers();

            //for testing and reset// 
            
            //localStorage.setItem('lastHungerAmount', 100);
            //localStorage.setItem('lastHungerTimeCheck', Date.now());
            

            //remove later://

        })

        box.addEventListener('click', ()=>{
            randomizeCatType();
            setTimeout(()=>displayRenamePopUp(), 100); //remove later for testing only//
            youReceivedText.style.opacity = 1;
            box.style.display = "none";
            cat.style.display = "flex";

        })

        renameInput.addEventListener('input', ()=>{
            renameName.innerHTML = renameInput.value;

            if ((renameInput.value).length > 10){
                renameName.innerHTML = (renameInput.value).slice(0,10);
                
            }
        })

        renameInput.addEventListener('keydown',(event)=>{
            if (event.key === "Enter"){
                renameInput.blur();
            }
        })

        renameConfirmBtn.addEventListener('click', ()=>{
            if(!renameInput.value){
                localStorage.setItem("catSavedName", JSON.stringify(catName));
            }
            else{
                catName = renameInput.value;
                localStorage.setItem("catSavedName",JSON.stringify(catName));

            }

            renamePopUpScreen.style.display = "none";
            catTypeText.innerHTML = catName;
            displayStatusBox();
        })

        itemsBtn.addEventListener('click', ()=>{
            itemsPopUpWrapper.style.display = "flex";
        })
        storeBtn.addEventListener('click', ()=>{
            storePopUpWrapper.style.display = "flex";
        })
        tasksBtn.addEventListener('click', ()=>{
            tasksPopUpWrapper.style.display = "flex";
        })

            

    </script>
    
</body>
</html>
